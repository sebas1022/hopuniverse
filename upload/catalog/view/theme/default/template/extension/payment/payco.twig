<div class="buttons">
  <div class="pull-right">
    <input id="button_confirm" type="submit" disabled="true" value="{{ button_confirm }}" class="btn btn-primary" />
  </div>
</div>

<form id="epayco_form" style="display: none;">
    <script
        src="https://checkout.epayco.co/checkout.js"
        class="epayco-button"
        data-epayco-key="{{ p_public_key }}"
        data-epayco-invoice ="{{ p_id_invoice }}"
        data-epayco-amount="{{ p_amount }}"
        data-epayco-tax="{{ p_tax }}"
        data-epayco-tax-base="{{ p_amount_base }}"
        data-epayco-name="{{ p_itemname}}"
        data-epayco-description="{{ p_description }}"
        data-epayco-currency="{{ p_currency_code }}"
        data-epayco-country="co"
        data-epayco-name-billing="{{ p_billing_first_name ~' '~ p_billing_last_name }}"
        data-epayco-address-billing="{{ p_billing_address }}"
        data-epayco-email-billing="{{ p_email }}"
        data-epayco-mobilephone-billing="{{ p_billing_phone }}"
        data-epayco-test="{{ p_test_mode }}"
        data-epayco-external="{{ p_payco_checkout_type }}"
        data-epayco-response="{{ p_url_response }}"
        data-epayco-confirmation="{{ p_url_confirmation }}"
        data-extra1="{{ p_extra1 }}">
    </script>
</form>

<script>
  // Función para habilitar el botón cuando epayco esté listo
  function enablePaycoButton() {
    var button = document.getElementById("button_confirm");
    var epaycoButton = document.querySelector(".epayco-button-render");
    
    if (epaycoButton) {
      // El botón de epayco está listo
      button.removeAttribute("disabled");
      console.log("Botón de Payco habilitado");
    } else {
      // Intentar de nuevo en 100ms
      setTimeout(enablePaycoButton, 100);
    }
  }
  
  // Iniciar la verificación cuando el DOM esté listo
  $(document).ready(function() {
    // Esperar un momento para que el script de epayco se cargue
    setTimeout(enablePaycoButton, 500);
  });

  // Cuando se haga clic en confirmar, disparar el botón de epayco
  $("#button_confirm").on("click", function(e) {
    e.preventDefault();
    var epaycoButton = $(".epayco-button-render");
    if (epaycoButton.length > 0) {
      epaycoButton.trigger("click");
    } else {
      alert("Error: El botón de pago aún no está listo. Por favor espera un momento e intenta de nuevo.");
    }
  });
</script>