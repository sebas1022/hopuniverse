{{ header }}
<div id="checkout-cart" class="container">
   <ul class="breadcrumb">
      {% for breadcrumb in breadcrumbs %} {% if loop.last %}
      <li class="breadcrumb-item" aria-current="page"><span class="link active">{{ breadcrumb.text }}</span></li>
      {% elseif loop.revindex0 == 1 %}
      <li class="breadcrumb-item" data-prev>
         <a href="{{ breadcrumb.href }}" class="link"><span>{{ breadcrumb.text }}</span></a>
      </li>
      {% else %}
      <li class="breadcrumb-item">
         <a href="{{ breadcrumb.href }}" class="link"><span>{{ breadcrumb.text }}</span></a>
      </li>
      {% endif %} {% endfor %}
   </ul>
   {% if attention %}
   <div class="alert alert-info"><i class="fa fa-info-circle"></i> {{ attention }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
   </div>
   {% endif %}
   {% if success %}
   <div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> {{ success }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
   </div>
   {% endif %}
   {% if error_warning %}
   <div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
   </div>
   {% endif %}
   <div class="row">
      {{ column_left }}
      {% if column_left and column_right %}
      {% set class = 'col-sm-6' %}
      {% elseif column_left or column_right %}
      {% set class = 'col-sm-9' %}
      {% else %}
      {% set class = 'col-sm-12' %}
      {% endif %}
      <div id="content" class="{{ class }}">
         {{ content_top }}
         <h1>{{ heading_title }}
            {% if weight %}
            &nbsp;({{ weight }})
            {% endif %} 
         </h1>
         <form action="{{ action }}" method="post" enctype="multipart/form-data">
            <div class="table-responsive">
               <table class="table table-bordered">
                  <thead>
                     <tr>
                        <td class="text-center">{{ column_image }}</td>
                        <td class="text-left">{{ column_name }}</td>
                        <td class="text-left">{{ column_model }}</td>
                        <td class="text-left">{{ column_quantity }}</td>
                        <td class="text-right">{{ column_price }}</td>
                        <td class="text-right">{{ column_total }}</td>
                     </tr>
                  </thead>
                  <tbody>
                     {% for product in products %}
                     <tr>
                        <td class="text-center">{% if product.thumb %} <a href="{{ product.href }}"><img src="{{ product.thumb }}" alt="{{ product.name }}" title="{{ product.name }}" class="img-thumbnail" /></a> {% endif %}</td>
                        <td class="text-left"><a href="{{ product.href }}">{{ product.name }}</a> {% if not product.stock %} <span class="text-danger">***</span> {% endif %}
                           {% if product.option %}
                           {% for option in product.option %} <br/>
                           <small>{{ option.name }}: {{ option.value }}</small> {% endfor %}
                           {% endif %}
                           {% if product.reward %} <br/>
                           <small>{{ product.reward }}</small> {% endif %}
                           {% if product.recurring %} <br/>
                           <span class="label label-info">{{ text_recurring_item }}</span> <small>{{ product.recurring }}</small> {% endif %}
                        </td>
                        <td class="text-left">{{ product.model }}</td>
                        <td class="text-left">
                           <div class="input-group btn-block" style="max-width: 160px;">
                              {#  <input type="text" name="quantity[<?php echo $product['key']; ?>]" value="<?php echo $product['quantity']; ?>" size="1" class="form-control" /> #}
                              <div class="input-group inc_dec_qty" style="max-width: 72px !important;top: 1px;">
                                 <span class="input-group-btn" style="float: none!important;" onclick="quantity_dec( $(this).parent(), {{ product.product_id }} )" >
                                 <button type="button" class="btn btn-default" >
                                 <span class="glyphicon glyphicon-minus"></span>
                                 </button>
                                 </span>
                                 <input type="text" style="font-size: 15px!important;text-align: center;height: 32px;" name="quantity[{{ product.cart_id }}]" size="2" value="{{ product.quantity }}" id="qty_box_{{ product.product_id }}" class="qty_box"/>
                                 <span class="input-group-btn" style="float: none!important;" onclick="quantity_inc( $(this).parent(), {{ product.product_id }} )" >
                                 <button type="button" class="btn btn-default">
                                 <span class="glyphicon glyphicon-plus"></span>
                                 </button>
                                 </span>
                              </div>
                              <script type="text/javascript">
                                 function setQuantity(t,id,n){
                                   var i=getQuantity(t);
                                   i+=1*(n?1:-1),1>i&&(i=1),t.attr("value",i.toString()).val(i.toString());
                                 }
								 function getQuantity(t){
                                 var n=parseInt(t.val());
                                 return("NaN"==typeof n||1>n)&&(n=1),n
                                 }
                                 function quantity_inc(t,id){
                                 setQuantity(t.find(".qty_box"),id,!0)
                                 calculate_cart_price(id);
                                 }
                                 function quantity_dec(t,id){
                                 setQuantity(t.find(".qty_box"),id,!1)
                                 calculate_cart_price(id);
                                 }
								 function calculate_cart_price(id){
                                 var cartid = $("#qty_box_"+id).attr('name').slice(9, -1);
                                 var quantity = $("#qty_box_"+id).val();
                                 var asdf = "popup page";
                                   $.ajax({
                                     type: 'POST',
                                     url: 'index.php?route=checkout/cart/change_price',
                                     data: {quantity:quantity,product_id:id,cartid:cartid,asdf:asdf},
                                     dataType: 'json',
                                       success: function(json) {
                                       if (json) {
                                 
                                           $("#use_dynamic_"+id).html(json.update_price);
                                 
                                 $("#update_cart").html(json.update_cart);
                                 var a = json.totals;
                                 //console.log(a.length)
                                 a.forEach(function(entry) {
                                 html  = '<table class="table table-bordered">';
                                 for(var i=0; i<a.length; i++)
                                 {
                                 html += '<tr>';
                                 html += '  <td class="text-right"><strong>' + json.totals[i].title + ':</strong></td>';
                                 html += '  <td class="text-right">' + json.totals[i].text + '</td>';
                                 html += '</tr>';
                                 }
                                 html += '</table>';
                                 $(".total_div").html(html);
                                 $(".old_table").remove();
                                 });
                                 }
                                      }
                                   });
                                 }      
                              </script>
                              <input type="hidden" name="product_id" size="2" value="{{ product.product_id }}" />
                              {#  <button type="button" class="btn green-btn col-sm-6" onclick="addcart('<?php echo $product['product_id']; ?>');">Add to Cart</button> #}
                              <span class="input-group-btn">
                              {#  <button type="submit" data-toggle="tooltip" title="<?php echo $button_update; ?>" class="btn btn-primary"><i class="fa fa-refresh"></i></button> #}
                              <button type="button" data-toggle="tooltip" style="height: 32px;border-radius:4px" title="{{ button_remove }}" class="btn btn-danger" onclick="cart.remove('{{ product.cart_id }}');"><i class="fa fa-times"></i></button></span>
                           </div>
                        </td>
                        <td class="text-right">{{ product.price }}
                           <input type="hidden" id="use_unitprice_{{ product.product_id }}" value="{{ product.without_sign_price }}">
                        </td>
                        <td class="text-right" class="use" id="use_dynamic_{{ product.product_id }}">  {{ product.total }}
                        </td>
                     </tr>
                     {% endfor %}
                     {% for voucher in vouchers %}
                     <tr>
                        <td></td>
                        <td class="text-left">{{ voucher.description }}</td>
                        <td class="text-left"></td>
                        <td class="text-left">
                           <div class="input-group btn-block" style="max-width: 200px;">
                              <input type="text" name="" value="1" size="1" disabled="disabled" class="form-control" />
                              <span class="input-group-btn">
                              <button type="button" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger" onclick="voucher.remove('{{ voucher.key }}');"><i class="fa fa-times-circle"></i></button>
                              </span>
                           </div>
                        </td>
                        <td class="text-right">{{ voucher.amount }}</td>
                        <td class="text-right">{{ voucher.amount }}</td>
                     </tr>
                     {% endfor %}
                  </tbody>
               </table>
            </div>
         </form>
         {% if modules %}
         <h2>{{ text_next }}</h2>
         <p>{{ text_next_choice }}</p>
         <div class="panel-group" id="accordion"> {% for module in modules %}
            {{ module }}
            {% endfor %} 
         </div>
         {% endif %} <br/>
         <div class="row">
            <div class="col-sm-4 col-sm-offset-8">
               <div class="total_div"></div>
               <table class="table table-bordered old_table">
                  {% for total in totals %}
                  <tr>
                     <td class="text-right"><strong>{{ total.title }}:</strong></td>
                     <td class="text-right">{{ total.text }}</td>
                  </tr>
                  {% endfor %}
               </table>
            </div>
         </div>
         <div class="buttons clearfix">
            <div class="pull-left"><a href="{{ continue }}" class="btn btn-default">{{ button_shopping }}</a></div>
            <div class="pull-right"><a href="{{ checkout }}" class="btn btn-primary">{{ button_checkout }}</a></div>
         </div>
         {{ content_bottom }}
      </div>
      {{ column_right }}
   </div>
</div>
<style>
@media (max-width: 600px) {
.fly-btn {
	display: none;
}
</style>
{{ footer }}